import{A as _,Aa as le,Ba as de,C as a,Ca as ue,D as o,E as p,Fa as me,Ga as pe,H as y,I as S,J as u,L as $,M as K,N as Q,P as l,Q as v,Qa as V,R as C,Ra as be,S as E,Sa as ge,T as X,V as T,W as w,X as j,a as R,aa as D,b as M,ba as I,c as U,d as A,e as z,fa as Z,g as H,ga as J,h as k,ha as ee,i as B,ia as te,k as h,l as f,m as b,n as x,na as ie,p as G,qa as ne,s,sa as ae,t as W,ta as oe,u as Y,ua as re,v as P,va as se,w as g,wa as ce,y as d}from"./chunk-RWUPR6KW.js";import{g as L}from"./chunk-6AOLKZEJ.js";var q=class r{constructor(t,e){this.supabaseService=t;this.authService=e;this.inicializarUsuarioActual()}temasSubject=new A([]);mensajesSubject=new A([]);notificacionesSubject=new U;paquetesSubject=new A([]);temas$=this.temasSubject.asObservable();mensajes$=this.mensajesSubject.asObservable();notificaciones$=this.notificacionesSubject.asObservable();paquetes$=this.paquetesSubject.asObservable();usuarioActual=null;inicializarUsuarioActual(){let t=this.authService.getCurrentUser();t&&(this.usuarioActual=this.convertirProfileAUsuario(t))}convertirProfileAUsuario(t){return{id:t.id||0,nombre:t.full_name||t.username||"Usuario",email:t.username||"",avatar:void 0,esAdmin:t.id_perfil===1}}obtenerTemas(){return this.cargarTemasDesdeDB(),this.temas$}cargarTemasDesdeDB(){try{this.supabaseService.client.from("chat_discusiones").select(`
          *,
          paquetes:paquete_id (
            id, 
            nombre, 
            descripcion, 
            tipo
          )
        `).order("created_at",{ascending:!1}).then(i=>L(this,[i],function*({data:t,error:e}){if(e){console.warn("Tabla chat_discusiones no existe o error:",e),this.crearTemasEjemplo();return}let n=[];for(let c of t||[])n.push({id:c.id,titulo:c.titulo,descripcion:c.descripcion,tipo:c.tipo,paqueteId:c.paquete_id,paquete:c.paquetes?{id:c.paquetes.id,nombre:c.paquetes.nombre,descripcion:c.paquetes.descripcion,tipo:c.paquetes.tipo}:void 0,adminId:c.admin_id,fechaCreacion:new Date(c.created_at),estado:c.estado||"activo",mensajesNoLeidos:0});this.temasSubject.next(n)}))}catch(t){console.error("Error cargando temas:",t),this.crearTemasEjemplo()}}crearTemasEjemplo(){let t=[{id:1,titulo:"Bienvenida al sistema",descripcion:"Espacio para presentarse y compartir experiencias",tipo:"terapia",paqueteId:1,adminId:1,fechaCreacion:new Date,estado:"activo",mensajesNoLeidos:0},{id:2,titulo:"Consejos generales",descripcion:"Compartamos tips y estrategias \xFAtiles",tipo:"rutina",paqueteId:2,adminId:1,fechaCreacion:new Date,estado:"activo",mensajesNoLeidos:0}];this.temasSubject.next(t)}crearTema(t){return new M(e=>{this.crearTemaEnDB(t).then(i=>{e.next(i),e.complete()}).catch(i=>{e.error(i)})})}crearTemaEnDB(t){return new Promise((e,i)=>{if(!this.usuarioActual?.esAdmin){i(new Error("Solo los administradores pueden crear discusiones"));return}this.supabaseService.client.from("chat_discusiones").insert({titulo:t.titulo,descripcion:t.descripcion,tipo:t.tipo,paquete_id:t.paqueteId,admin_id:this.usuarioActual.id,estado:"activo"}).select().single().then(({data:n,error:c})=>{if(c){if(c.code==="42P01"){this.crearTablasBasicas().then(()=>{this.crearTemaEnDB(t).then(e).then(null,i)}).then(null,()=>{i(new Error("No se pudieron crear las tablas necesarias"))});return}i(c);return}let m={id:n.id,titulo:n.titulo,descripcion:n.descripcion,tipo:n.tipo,paqueteId:n.paquete_id,adminId:n.admin_id,fechaCreacion:new Date(n.created_at),estado:n.estado,mensajesNoLeidos:0};this.cargarTemasDesdeDB(),this.notificacionesSubject.next("Discusi\xF3n creada exitosamente"),e(m)}).then(null,n=>{console.error("Error creando tema:",n),i(n)})})}actualizarEstadoTema(t,e){return new M(i=>{this.actualizarEstadoTemaEnDB(t,e).then(n=>{i.next(n),i.complete()}).catch(n=>{i.error(n)})})}actualizarEstadoTemaEnDB(t,e){return new Promise(i=>{if(!this.usuarioActual?.esAdmin){this.notificacionesSubject.next("Solo los administradores pueden cambiar el estado"),i(!1);return}this.supabaseService.client.from("chat_discusiones").update({estado:e,updated_at:new Date().toISOString()}).eq("id",t).then(({error:n})=>{if(n){console.error("Error actualizando estado del tema:",n),i(!1);return}this.cargarTemasDesdeDB(),this.notificacionesSubject.next(`Discusi\xF3n ${e==="activo"?"abierta":"cerrada"}`),i(!0)}).then(null,n=>{console.error("Error actualizando estado del tema:",n),i(!1)})})}obtenerMensajes(t){return this.cargarMensajesDesdeDB(t),this.mensajes$}cargarMensajesDesdeDB(t){try{this.supabaseService.client.from("chat_mensajes").select(`
          *,
          profiles:usuario_id (
            id,
            full_name,
            username,
            id_perfil
          )
        `).eq("tema_id",t).order("created_at",{ascending:!0}).then(({data:e,error:i})=>{if(i){console.warn("Tabla chat_mensajes no existe o error:",i),this.crearMensajesEjemplo(t);return}let n=(e||[]).map(c=>{let m=c.profiles;return{id:c.id,temaId:c.tema_id,usuarioId:c.usuario_id,usuario:{id:m?.id||c.usuario_id,nombre:m?.full_name||m?.username||"Usuario",email:m?.username||"",esAdmin:m?.id_perfil===1},mensaje:c.mensaje,fechaEnvio:new Date(c.created_at),editado:c.editado||!1,fechaEdicion:c.updated_at?new Date(c.updated_at):void 0,esAdmin:m?.id_perfil===1}});this.mensajesSubject.next(n)})}catch(e){console.error("Error cargando mensajes:",e),this.crearMensajesEjemplo(t)}}crearMensajesEjemplo(t){let e=[{id:1,temaId:t,usuarioId:1,usuario:{id:1,nombre:"Administrador",email:"admin@ejemplo.com",esAdmin:!0},mensaje:"\xA1Bienvenidos a esta discusi\xF3n! Si\xE9ntanse libres de compartir sus experiencias.",fechaEnvio:new Date,editado:!1,esAdmin:!0}];this.mensajesSubject.next(e)}enviarMensaje(t,e){return new M(i=>{this.enviarMensajeADB(t,e).then(n=>{i.next(n),i.complete()}).catch(n=>{i.error(n)})})}enviarMensajeADB(t,e){return new Promise((i,n)=>{if(!this.usuarioActual){n(new Error("Usuario no autenticado"));return}this.supabaseService.client.from("chat_mensajes").insert({tema_id:t,usuario_id:this.usuarioActual.id,mensaje:e.trim(),editado:!1}).select().single().then(({data:c,error:m})=>{if(m){if(m.code==="42P01"){this.crearTablasBasicas().then(()=>{this.enviarMensajeADB(t,e).then(i).then(null,n)}).then(null,()=>{n(new Error("No se pudieron crear las tablas necesarias"))});return}n(m);return}let fe={id:c.id,temaId:c.tema_id,usuarioId:c.usuario_id,usuario:this.usuarioActual,mensaje:c.mensaje,fechaEnvio:new Date(c.created_at),editado:!1,esAdmin:this.usuarioActual.esAdmin};this.cargarMensajesDesdeDB(t),i(fe)}).then(null,c=>{console.error("Error enviando mensaje:",c),n(c)})})}obtenerPaquetes(){return this.cargarPaquetesDesdeDB(),this.paquetes$}cargarPaquetesDesdeDB(){try{this.supabaseService.client.from("paquetes").select("id, nombre, descripcion, tipo").eq("status",1).order("nombre").then(({data:t,error:e})=>{if(e||!t||t.length===0){console.warn("No se pudieron cargar paquetes, intentando cargar rutinas y terapias separadamente"),this.cargarRutinasYTerapias();return}let i=t.map(n=>({id:n.id,nombre:n.nombre,descripcion:n.descripcion,tipo:n.tipo}));this.paquetesSubject.next(i)})}catch(t){console.error("Error cargando paquetes:",t),this.cargarRutinasYTerapias()}}cargarRutinasYTerapias(){let t=[];this.supabaseService.client.from("rutinas").select("id, nombre, descripcion").eq("status",1).order("nombre").then(({data:e,error:i})=>{!i&&e&&e.forEach(n=>{t.push({id:n.id,nombre:n.nombre,descripcion:n.descripcion,tipo:"rutina"})}),this.supabaseService.client.from("terapias").select("id, nombre, descripcion").eq("status",1).order("nombre").then(({data:n,error:c})=>{!c&&n&&n.forEach(m=>{t.push({id:m.id+1e3,nombre:m.nombre,descripcion:m.descripcion,tipo:"terapia"})}),t.length===0?this.crearPaquetesEjemplo():this.paquetesSubject.next(t)})})}crearPaquetesEjemplo(){let t=[{id:1,nombre:"Rutina B\xE1sica de Rehabilitaci\xF3n",descripcion:"Ejercicios b\xE1sicos para comenzar",tipo:"rutina"},{id:2,nombre:"Terapia Respiratoria",descripcion:"T\xE9cnicas de respiraci\xF3n",tipo:"terapia"},{id:3,nombre:"Rutina de Fortalecimiento",descripcion:"Ejercicios de fuerza",tipo:"rutina"},{id:4,nombre:"Terapia de Movilidad",descripcion:"Ejercicios de movilidad articular",tipo:"terapia"}];this.paquetesSubject.next(t)}obtenerPaquetesPorTipo(t){return new M(e=>{this.supabaseService.client.from("paquetes").select("id, nombre, descripcion, tipo").eq("tipo",t).eq("status",1).order("nombre").then(({data:i,error:n})=>{if(n){e.error(n);return}let c=(i||[]).map(m=>({id:m.id,nombre:m.nombre,descripcion:m.descripcion,tipo:m.tipo}));e.next(c),e.complete()})})}marcarMensajesComoLeidos(t){this.usuarioActual&&this.supabaseService.client.rpc("marcar_mensajes_como_leidos",{p_usuario_id:this.usuarioActual.id,p_tema_id:t}).then(({data:e,error:i})=>{if(i){console.error("Error marcando mensajes como le\xEDdos:",i);return}console.log("Mensajes marcados como le\xEDdos para tema:",t),this.cargarTemasDesdeDB()})}contarMensajesNoLeidos(t){return new Promise(e=>{if(!this.usuarioActual){e(0);return}this.supabaseService.client.rpc("obtener_mensajes_no_leidos",{p_usuario_id:this.usuarioActual.id,p_tema_id:t}).then(({data:i,error:n})=>{if(n){console.error("Error contando mensajes no le\xEDdos:",n),e(0);return}let c=i&&i.length>0?i[0].mensajes_no_leidos:0;e(c||0)})})}obtenerUsuarioActual(){if(!this.usuarioActual){let t=this.authService.getCurrentUser();t?this.usuarioActual=this.convertirProfileAUsuario(t):this.usuarioActual={id:0,nombre:"Usuario An\xF3nimo",email:"anonimo@example.com",esAdmin:!1}}return this.usuarioActual}esAdmin(){return this.obtenerUsuarioActual().esAdmin}limpiarEstado(){this.temasSubject.next([]),this.mensajesSubject.next([])}crearTablasBasicas(){return new Promise((t,e)=>{console.log("Creando tablas b\xE1sicas para chat..."),Promise.all([this.supabaseService.client.rpc("execute_sql",{sql:`
        CREATE TABLE IF NOT EXISTS chat_discusiones (
          id BIGSERIAL PRIMARY KEY,
          titulo VARCHAR(255) NOT NULL,
          descripcion TEXT,
          tipo VARCHAR(20) CHECK (tipo IN ('terapia', 'rutina')),
          paquete_id BIGINT REFERENCES paquetes(id),
          admin_id BIGINT REFERENCES profiles(id),
          estado VARCHAR(20) DEFAULT 'activo' CHECK (estado IN ('activo', 'cerrado')),
          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );
      `}),this.supabaseService.client.rpc("execute_sql",{sql:`
        CREATE TABLE IF NOT EXISTS chat_mensajes (
          id BIGSERIAL PRIMARY KEY,
          tema_id BIGINT REFERENCES chat_discusiones(id) ON DELETE CASCADE,
          usuario_id BIGINT REFERENCES profiles(id),
          mensaje TEXT NOT NULL,
          editado BOOLEAN DEFAULT FALSE,
          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );
      `})]).then(()=>{console.log("Tablas de chat creadas exitosamente"),t()}).catch(c=>{console.error("Error creando tablas b\xE1sicas:",c),t()})})}simularNuevoMensaje(t){console.log("Simulaci\xF3n de mensajes deshabilitada - usando datos reales")}static \u0275fac=function(e){return new(e||r)(B(be),B(ge))};static \u0275prov=H({token:r,factory:r.\u0275fac,providedIn:"root"})};var xe=["mensajesContainer"];function _e(r,t){if(r&1){let e=y();a(0,"button",21),S("click",function(){h(e);let n=u();return f(n.mostrarFormularioTema=!0)}),b(),a(1,"svg",22),p(2,"path",23),o(),l(3," Crear Nueva Discusi\xF3n "),o()}}function Ce(r,t){if(r&1&&(a(0,"option",45),l(1),o()),r&2){let e=t.$implicit;d("value",e.id),s(),C(" ",e.nombre," ")}}function Se(r,t){if(r&1){let e=y();a(0,"div")(1,"label",29),l(2),o(),a(3,"select",43),j("ngModelChange",function(n){h(e);let c=u(2);return w(c.nuevoTema.paqueteId,n)||(c.nuevoTema.paqueteId=n),f(n)}),a(4,"option",33),l(5),o(),g(6,Ce,2,2,"option",44),o()()}if(r&2){let e=u(2);s(2),C(" ",e.nuevoTema.tipo==="terapia"?"Terapia":"Rutina"," "),s(),T("ngModel",e.nuevoTema.paqueteId),s(2),C("Seleccionar ",e.nuevoTema.tipo,""),s(),d("ngForOf",e.paquetesFiltrados)("ngForTrackBy",e.trackByPaquete)}}function ye(r,t){if(r&1){let e=y();a(0,"div",24)(1,"h3",25),b(),a(2,"svg",26),p(3,"path",27),o(),l(4," Nueva Discusi\xF3n "),o(),x(),a(5,"form",28),S("ngSubmit",function(){h(e);let n=u();return f(n.crearTema())}),a(6,"div")(7,"label",29),l(8,"T\xEDtulo"),o(),a(9,"input",30),j("ngModelChange",function(n){h(e);let c=u();return w(c.nuevoTema.titulo,n)||(c.nuevoTema.titulo=n),f(n)}),o()(),a(10,"div")(11,"label",29),l(12,"Descripci\xF3n"),o(),a(13,"textarea",31),j("ngModelChange",function(n){h(e);let c=u();return w(c.nuevoTema.descripcion,n)||(c.nuevoTema.descripcion=n),f(n)}),o()(),a(14,"div")(15,"label",29),l(16,"Tipo"),o(),a(17,"select",32),j("ngModelChange",function(n){h(e);let c=u();return w(c.nuevoTema.tipo,n)||(c.nuevoTema.tipo=n),f(n)}),S("change",function(){h(e);let n=u();return f(n.onTemaTyping())}),a(18,"option",33),l(19,"Seleccionar tipo"),o(),a(20,"option",34),l(21,"\u{1FA7A} Terapia"),o(),a(22,"option",35),l(23,"\u{1F4AA} Rutina"),o()()(),g(24,Se,7,5,"div",36),a(25,"div",37)(26,"button",38)(27,"span",39),b(),a(28,"svg",22),p(29,"path",40),o(),l(30," Crear "),o()(),x(),a(31,"button",41),S("click",function(){h(e);let n=u();return f(n.cancelarCreacion())}),a(32,"span",39),b(),a(33,"svg",22),p(34,"path",42),o(),l(35," Cancelar "),o()()()()()}if(r&2){let e=u();s(9),T("ngModel",e.nuevoTema.titulo),s(4),T("ngModel",e.nuevoTema.descripcion),s(4),T("ngModel",e.nuevoTema.tipo),s(7),d("ngIf",e.nuevoTema.tipo),s(2),d("disabled",!e.formularioValido())}}function Ee(r,t){r&1&&(a(0,"span"),l(1,"\xA1Crea la primera discusi\xF3n!"),o())}function Te(r,t){r&1&&(a(0,"span"),l(1,"Espera a que el administrador cree una discusi\xF3n."),o())}function we(r,t){if(r&1&&(a(0,"div",46)(1,"div",47),l(2,"\u{1F4DD}"),o(),a(3,"p",48),l(4,"No hay discusiones a\xFAn"),o(),a(5,"p",49),g(6,Ee,2,0,"span",36)(7,Te,2,0,"span",36),o()()),r&2){let e=u();s(6),d("ngIf",e.isAdmin),s(),d("ngIf",!e.isAdmin)}}function je(r,t){if(r&1&&(a(0,"div",66),l(1),o()),r&2){let e=u().$implicit;s(),C(" ",e.mensajesNoLeidos>99?"99+":e.mensajesNoLeidos," ")}}function Me(r,t){r&1&&p(0,"div",67)}function De(r,t){if(r&1){let e=y();a(0,"div",50),S("click",function(){let n=h(e).$implicit,c=u();return f(c.seleccionarTema(n))}),a(1,"div",51)(2,"div",52)(3,"div",53)(4,"h3",54),l(5),o(),a(6,"span",55),l(7),D(8,"titlecase"),o()(),a(9,"p",56),l(10),o(),a(11,"div",57)(12,"div",58)(13,"span",59),b(),a(14,"svg",60),p(15,"path",61),o(),l(16),o(),x(),a(17,"span",62),l(18),D(19,"titlecase"),o()(),a(20,"span"),l(21),o()()(),a(22,"div",63),g(23,je,2,1,"div",64)(24,Me,1,0,"div",65),o()()()}if(r&2){let e=t.$implicit,i=u();_("bg-blue-50",(i.temaSeleccionado==null?null:i.temaSeleccionado.id)===e.id)("border-l-4",(i.temaSeleccionado==null?null:i.temaSeleccionado.id)===e.id)("border-l-blue-500",(i.temaSeleccionado==null?null:i.temaSeleccionado.id)===e.id)("estado-activo",e.estado==="activo")("estado-cerrado",e.estado==="cerrado"),s(5),v(e.titulo),s(),d("ngClass",i.obtenerColorTipo(e.tipo)),s(),E(" ",e.tipo==="terapia"?"\u{1FA7A}":"\u{1F4AA}"," ",I(8,22,e.tipo)," "),s(3),v(e.descripcion),s(6),C(" ",i.contarMensajesDelTema(e.id)," "),s(),d("ngClass",i.obtenerEstadoVisual(e.estado).color),s(),E(" ",i.obtenerEstadoVisual(e.estado).icono," ",I(19,24,e.estado)," "),s(3),v(i.formatearFecha(e.fechaCreacion)),s(2),d("ngIf",e.mensajesNoLeidos>0),s(),d("ngIf",e.mensajesNoLeidos===0)}}function Ie(r,t){r&1&&(b(),p(0,"path",79))}function Ae(r,t){r&1&&(b(),p(0,"path",80))}function ke(r,t){if(r&1){let e=y();a(0,"button",76),S("click",function(){h(e);let n=u(2);return f(n.toggleEstadoTema())}),b(),a(1,"svg",22),g(2,Ie,1,0,"path",77)(3,Ae,1,0,"path",78),o(),l(4),o()}if(r&2){let e=u(2);_("bg-red-500",e.temaSeleccionado.estado==="activo")("hover:bg-red-400",e.temaSeleccionado.estado==="activo")("bg-green-500",e.temaSeleccionado.estado==="cerrado")("hover:bg-green-400",e.temaSeleccionado.estado==="cerrado"),s(2),d("ngIf",e.temaSeleccionado.estado==="activo"),s(),d("ngIf",e.temaSeleccionado.estado==="cerrado"),s(),C(" ",e.temaSeleccionado.estado==="activo"?"Cerrar Discusi\xF3n":"Abrir Discusi\xF3n"," ")}}function Pe(r,t){if(r&1&&(a(0,"div",68)(1,"div",4)(2,"div",52)(3,"div",69)(4,"h1",70),l(5),o(),a(6,"span",71),l(7),D(8,"titlecase"),o()(),a(9,"p",72),l(10),o(),a(11,"div",73)(12,"span",59),b(),a(13,"svg",22),p(14,"path",74),o(),l(15),o(),x(),a(16,"span",59),b(),a(17,"svg",22),p(18,"path",61),o(),l(19),o(),x(),a(20,"span",62),l(21),D(22,"titlecase"),o()()(),g(23,ke,5,11,"button",75),o()()),r&2){let e=u();s(5),v(e.temaSeleccionado.titulo),s(),d("ngClass",e.obtenerColorTipo(e.temaSeleccionado.tipo)),s(),E(" ",e.temaSeleccionado.tipo==="terapia"?"\u{1FA7A}":"\u{1F4AA}"," ",I(8,12,e.temaSeleccionado.tipo)," "),s(3),v(e.temaSeleccionado.descripcion),s(5),C(" Creado: ",e.formatearFecha(e.temaSeleccionado.fechaCreacion)," "),s(4),E(" ",e.mensajesChat.length," mensaje",e.mensajesChat.length!==1?"s":""," "),s(),d("ngClass",e.obtenerEstadoVisual(e.temaSeleccionado.estado).color),s(),E(" ",e.obtenerEstadoVisual(e.temaSeleccionado.estado).icono," ",I(22,14,e.temaSeleccionado.estado)," "),s(2),d("ngIf",e.isAdmin)}}function qe(r,t){r&1&&(a(0,"div",84)(1,"div",85),b(),a(2,"svg",86),p(3,"path",61),o()(),x(),a(4,"h3",87),l(5,"\xA1Inicia la conversaci\xF3n!"),o(),a(6,"p",88),l(7,"S\xE9 el primero en comentar en esta discusi\xF3n. Comparte tus dudas, experiencias o consejos sobre este tema."),o()())}function Oe(r,t){r&1&&(a(0,"div",103),l(1," Admin "),o())}function Ne(r,t){r&1&&(a(0,"div",104),b(),a(1,"svg",60),p(2,"path",27),o(),l(3," Editado "),o())}function Be(r,t){if(r&1&&(a(0,"div",89)(1,"div",90)(2,"div",91),p(3,"img",92),a(4,"div",93),l(5),o()(),g(6,Oe,2,0,"div",94),o(),a(7,"div",95)(8,"div",96)(9,"div",97)(10,"span",98),l(11),o(),a(12,"span",99),l(13),o()(),a(14,"div",100)(15,"p",101),l(16),o()(),g(17,Ne,4,0,"div",102),o()()()),r&2){let e=t.$implicit,i=u(2);_("flex-row-reverse",e.esAdmin)("justify-start",!e.esAdmin)("justify-end",e.esAdmin),s(3),_("border-blue-500",e.esAdmin)("border-gray-300",!e.esAdmin),d("src",e.usuario.avatar||"/assets/default-avatar.png",G)("alt",e.usuario.nombre),s(),_("bg-blue-500",e.esAdmin)("bg-gray-500",!e.esAdmin)("border-blue-500",e.esAdmin)("border-gray-300",!e.esAdmin),s(),C(" ",i.obtenerIniciales(e.usuario.nombre)," "),s(),d("ngIf",e.esAdmin),s(),_("order-first",e.esAdmin),s(),_("burbuja-admin",e.esAdmin)("text-white",e.esAdmin)("burbuja-usuario",!e.esAdmin)("text-gray-800",!e.esAdmin),s(),_("text-blue-100",e.esAdmin)("text-gray-600",!e.esAdmin),s(2),v(e.usuario.nombre),s(2),v(i.formatearFecha(e.fechaEnvio)),s(3),v(e.mensaje),s(),d("ngIf",e.editado)}}function Ve(r,t){if(r&1&&(a(0,"div",81,0),g(2,qe,8,0,"div",82)(3,Be,18,40,"div",83),o()),r&2){let e=u();s(2),d("ngIf",e.mensajesChat.length===0),s(),d("ngForOf",e.mensajesChat)("ngForTrackBy",e.trackByMensaje)}}function Fe(r,t){r&1&&(a(0,"span",122),l(1," Admin "),o())}function Le(r,t){r&1&&(a(0,"span",123),l(1," \u2713 Listo para enviar "),o())}function Re(r,t){if(r&1){let e=y();a(0,"div",105)(1,"div",106)(2,"div",107)(3,"div",108)(4,"span",109),l(5),o()(),a(6,"span"),l(7,"Escribiendo como "),a(8,"strong"),l(9),o()(),g(10,Fe,2,0,"span",110),o()(),a(11,"div",111)(12,"div",112)(13,"div",91)(14,"textarea",113),j("ngModelChange",function(n){h(e);let c=u();return w(c.nuevoMensaje,n)||(c.nuevoMensaje=n),f(n)}),S("keydown.enter",function(n){h(e);let c=u();return f(c.enviarMensaje(n))}),o(),a(15,"div",114),l(16),o()(),a(17,"div",115)(18,"span",59),b(),a(19,"svg",60),p(20,"path",116),o(),l(21," Presiona Ctrl + Enter para enviar r\xE1pidamente "),o(),g(22,Le,2,0,"span",117),o()(),x(),a(23,"button",118),S("click",function(){h(e);let n=u();return f(n.enviarMensaje())}),b(),a(24,"svg",119),p(25,"path",120),o(),x(),a(26,"span",121),l(27,"Enviar"),o()()()()}if(r&2){let e=u();s(5),v(e.obtenerIniciales((e.usuarioActual==null?null:e.usuarioActual.nombre)||"U")),s(4),v((e.usuarioActual==null?null:e.usuarioActual.nombre)||"Usuario"),s(),d("ngIf",e.isAdmin),s(4),_("border-blue-300",e.nuevoMensaje.trim().length>0),T("ngModel",e.nuevoMensaje),s(2),C(" ",e.nuevoMensaje.length,"/1000 "),s(6),d("ngIf",e.nuevoMensaje.trim().length>0),s(),_("transform",e.nuevoMensaje.trim().length>0)("scale-105",e.nuevoMensaje.trim().length>0),d("disabled",!e.nuevoMensaje.trim())}}function Ue(r,t){r&1&&(a(0,"div",124)(1,"div",125),b(),a(2,"svg",126),p(3,"path",79),o()(),x(),a(4,"h3",127),l(5,"Discusi\xF3n cerrada"),o(),a(6,"p",128),l(7,"Esta discusi\xF3n ha sido cerrada por el administrador y no se pueden agregar nuevos mensajes."),o()())}function ze(r,t){r&1&&(a(0,"li"),l(1,"\u2022 Como admin, puedes crear nuevos temas"),o())}function He(r,t){if(r&1&&(a(0,"div",129)(1,"div",130)(2,"div",131),b(),a(3,"svg",132),p(4,"path",61),o()(),x(),a(5,"h3",133),l(6,"\xA1Bienvenido al centro de discusiones!"),o(),a(7,"p",134),l(8,"Selecciona una discusi\xF3n de la lista para comenzar a participar en la conversaci\xF3n y compartir tus experiencias."),o(),a(9,"div",135)(10,"h4",136),l(11,"\u{1F4A1} \xBFC\xF3mo funciona?"),o(),a(12,"ul",137)(13,"li"),l(14,"\u2022 Selecciona un tema de la izquierda"),o(),a(15,"li"),l(16,"\u2022 Participa en la discusi\xF3n"),o(),a(17,"li"),l(18,"\u2022 Comparte tus experiencias y dudas"),o(),g(19,ze,2,0,"li",36),o()()()()),r&2){let e=u();s(19),d("ngIf",e.isAdmin)}}var O=class r{constructor(t){this.chatService=t}mensajesContainer;usuarioActual;isAdmin=!1;temasDiscusion=[];temaSeleccionado=null;mensajesChat=[];paquetesDisponibles=[];mostrarFormularioTema=!1;nuevoTema={titulo:"",descripcion:"",tipo:"",paqueteId:null};nuevoMensaje="";subscripciones=new R;shouldScrollToBottom=!1;ngOnInit(){this.usuarioActual=this.chatService.obtenerUsuarioActual(),this.isAdmin=this.chatService.esAdmin(),this.cargarDatosIniciales(),this.configurarActualizacionAutomatica()}ngOnDestroy(){this.subscripciones.unsubscribe(),this.chatService.limpiarEstado()}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}cargarDatosIniciales(){this.cargarPaquetes(),this.cargarTemas(),this.suscribirANotificaciones()}cargarPaquetes(){let t=this.chatService.obtenerPaquetes().subscribe(e=>this.paquetesDisponibles=e);this.subscripciones.add(t)}cargarTemas(){let t=this.chatService.obtenerTemas().subscribe(e=>this.temasDiscusion=e);this.subscripciones.add(t)}suscribirANotificaciones(){let t=this.chatService.notificaciones$.subscribe(e=>{console.log("Notificaci\xF3n:",e),this.mostrarNotificacion(e)});this.subscripciones.add(t)}mostrarNotificacion(t){console.log("\u{1F4E2} Notificaci\xF3n:",t)}seleccionarTema(t){this.temaSeleccionado=t,this.cargarMensajes(t.id),this.chatService.marcarMensajesComoLeidos(t.id)}cargarMensajes(t){let e=this.chatService.obtenerMensajes(t).subscribe(i=>{this.mensajesChat=i,this.shouldScrollToBottom=!0});this.subscripciones.add(e)}crearTema(){if(!this.formularioValido())return;let t=this.chatService.crearTema({titulo:this.nuevoTema.titulo,descripcion:this.nuevoTema.descripcion,tipo:this.nuevoTema.tipo,paqueteId:this.nuevoTema.paqueteId}).subscribe(e=>{this.cancelarCreacion(),this.seleccionarTema(e)},e=>{console.error("Error al crear tema:",e)});this.subscripciones.add(t)}formularioValido(){return!!(this.nuevoTema.titulo.trim()&&this.nuevoTema.descripcion.trim()&&this.nuevoTema.tipo&&this.nuevoTema.paqueteId)}cancelarCreacion(){this.mostrarFormularioTema=!1,this.nuevoTema={titulo:"",descripcion:"",tipo:"",paqueteId:null}}toggleEstadoTema(){if(!this.temaSeleccionado)return;let t=this.temaSeleccionado.estado==="activo"?"cerrado":"activo",e=this.chatService.actualizarEstadoTema(this.temaSeleccionado.id,t).subscribe(i=>{i&&this.temaSeleccionado&&(this.temaSeleccionado.estado=t)});this.subscripciones.add(e)}enviarMensaje(t){if(t&&t instanceof KeyboardEvent&&!t.ctrlKey){t.preventDefault();return}if(!this.nuevoMensaje.trim()||!this.temaSeleccionado)return;let e=this.chatService.enviarMensaje(this.temaSeleccionado.id,this.nuevoMensaje.trim()).subscribe(i=>{this.nuevoMensaje="",this.shouldScrollToBottom=!0,Math.random()>.7&&this.chatService.simularNuevoMensaje(this.temaSeleccionado.id)},i=>{console.error("Error al enviar mensaje:",i)});this.subscripciones.add(e)}scrollToBottom(){try{let t=this.mensajesContainer.nativeElement;t.scrollTop=t.scrollHeight}catch(t){console.log("Error al hacer scroll:",t)}}marcarMensajesComoLeidos(t){this.chatService.marcarMensajesComoLeidos(t)}trackByMensaje(t,e){return e.id}trackByTema(t,e){return e.id}trackByPaquete(t,e){return e.id}get paquetesFiltrados(){return this.nuevoTema.tipo?this.paquetesDisponibles.filter(t=>t.tipo===this.nuevoTema.tipo):[]}configurarActualizacionAutomatica(){let t=z(3e4).subscribe(()=>{if(this.temasDiscusion.length>0&&Math.random()>.8){let e=this.temasDiscusion[Math.floor(Math.random()*this.temasDiscusion.length)];e.estado==="activo"&&this.chatService.simularNuevoMensaje(e.id)}});this.subscripciones.add(t)}obtenerIniciales(t){return t.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().substring(0,2)}formatearFecha(t){let i=new Date().getTime()-t.getTime(),n=Math.floor(i/(1e3*60)),c=Math.floor(i/(1e3*60*60)),m=Math.floor(i/(1e3*60*60*24));return n<1?"Ahora":n<60?`${n}m`:c<24?`${c}h`:m<7?`${m}d`:t.toLocaleDateString()}obtenerColorTipo(t){return t==="terapia"?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"}obtenerEstadoVisual(t){return t==="activo"?{color:"text-green-600",icono:"\u{1F7E2}"}:{color:"text-red-600",icono:"\u{1F534}"}}onTemaTyping(){this.nuevoTema.tipo&&this.chatService.obtenerPaquetesPorTipo(this.nuevoTema.tipo).subscribe(t=>{})}contarMensajesDelTema(t){return this.mensajesChat.filter(e=>e.temaId===t).length}hayMensajesNoLeidos(){return this.temasDiscusion.some(t=>t.mensajesNoLeidos>0)}totalMensajesNoLeidos(){return this.temasDiscusion.reduce((t,e)=>t+e.mensajesNoLeidos,0)}static \u0275fac=function(e){return new(e||r)(W(q))};static \u0275cmp=Y({type:r,selectors:[["app-chat-discussion"]],viewQuery:function(e,i){if(e&1&&$(xe,5),e&2){let n;K(n=Q())&&(i.mensajesContainer=n.first)}},standalone:!1,decls:24,vars:14,consts:[["mensajesContainer",""],[1,"flex","h-screen","bg-gray-50"],[1,"w-1/3","bg-white","border-r","border-gray-300","flex","flex-col","shadow-lg"],[1,"p-4","border-b","border-gray-200","bg-gradient-to-r","from-blue-600","to-blue-700","text-white"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-bold"],[1,"text-blue-100","text-sm","mt-1"],[1,"text-right"],[1,"w-10","h-10","bg-blue-500","rounded-full","flex","items-center","justify-center"],[1,"text-sm","font-bold"],["class","mt-3 w-full bg-blue-500 hover:bg-blue-400 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 flex items-center justify-center gap-2 shadow-md hover:shadow-lg",3,"click",4,"ngIf"],["class","p-4 bg-gradient-to-br from-blue-50 to-indigo-50 border-b border-blue-200 formulario-nuevo-tema",4,"ngIf"],[1,"flex-1","overflow-y-auto"],["class","p-8 text-center text-gray-500",4,"ngIf"],["class","p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-all duration-200 relative",3,"bg-blue-50","border-l-4","border-l-blue-500","estado-activo","estado-cerrado","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-1","flex","flex-col","bg-white"],["class","p-4 bg-white border-b border-gray-200 shadow-sm",4,"ngIf"],["class","flex-1 overflow-y-auto p-4 space-y-4 area-mensajes",4,"ngIf"],["class","p-4 bg-white border-t border-gray-200 shadow-lg",4,"ngIf"],["class","p-6 bg-gray-50 border-t border-gray-200 text-center",4,"ngIf"],["class","flex-1 flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100",4,"ngIf"],[1,"mt-3","w-full","bg-blue-500","hover:bg-blue-400","px-4","py-2","rounded-lg","text-sm","font-medium","transition-all","duration-200","flex","items-center","justify-center","gap-2","shadow-md","hover:shadow-lg",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"p-4","bg-gradient-to-br","from-blue-50","to-indigo-50","border-b","border-blue-200","formulario-nuevo-tema"],[1,"font-semibold","text-gray-800","mb-3","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"space-y-3",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["name","titulo","placeholder","Ej: \xBFC\xF3mo iniciar ejercicios de rehabilitaci\xF3n?","maxlength","255","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","input-focus",3,"ngModelChange","ngModel"],["name","descripcion","placeholder","Describe el tema de discusi\xF3n...","maxlength","500","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","h-20","resize-none","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","input-focus",3,"ngModelChange","ngModel"],["name","tipo","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all",3,"ngModelChange","change","ngModel"],["value",""],["value","terapia"],["value","rutina"],[4,"ngIf"],[1,"flex","gap-2","pt-2"],["type","submit",1,"flex-1","bg-gradient-to-r","from-green-600","to-green-700","hover:from-green-500","hover:to-green-600","disabled:from-gray-400","disabled:to-gray-500","text-white","p-3","rounded-lg","transition-all","duration-200","font-medium","btn-gradient",3,"disabled"],[1,"flex","items-center","justify-center","gap-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"],["type","button",1,"flex-1","bg-gray-500","hover:bg-gray-400","text-white","p-3","rounded-lg","transition-all","duration-200","font-medium",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],["name","paqueteId","required","",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"value"],[1,"p-8","text-center","text-gray-500"],[1,"text-4xl","mb-4"],[1,"font-medium"],[1,"text-sm","mt-1"],[1,"p-4","border-b","border-gray-100","cursor-pointer","hover:bg-gray-50","transition-all","duration-200","relative",3,"click"],[1,"flex","items-start","justify-between"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","mb-1"],[1,"font-semibold","text-gray-800","truncate"],[1,"text-xs","px-2","py-1","rounded-full","flex-shrink-0",3,"ngClass"],[1,"text-sm","text-gray-600","mb-2","line-clamp-2"],[1,"flex","items-center","justify-between","text-xs","text-gray-500"],[1,"flex","items-center","gap-3"],[1,"flex","items-center","gap-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.959 8.959 0 01-4.906-1.468L3 21l1.468-5.094A8.959 8.959 0 013 12c0-4.418 3.582-8 8-8s8 3.582 8 8z"],[1,"flex","items-center","gap-1",3,"ngClass"],[1,"flex","items-center","ml-3","flex-shrink-0"],["class","contador-no-leidos",4,"ngIf"],["class","w-2 h-2 rounded-full bg-gray-300",4,"ngIf"],[1,"contador-no-leidos"],[1,"w-2","h-2","rounded-full","bg-gray-300"],[1,"p-4","bg-white","border-b","border-gray-200","shadow-sm"],[1,"flex","items-center","gap-3","mb-2"],[1,"text-xl","font-bold","text-gray-800","truncate"],[1,"px-3","py-1","rounded-full","text-sm","font-medium","flex-shrink-0",3,"ngClass"],[1,"text-sm","text-gray-600","mb-3","line-clamp-2"],[1,"flex","items-center","gap-4","text-sm","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],["class","px-4 py-2 rounded-lg transition-all duration-200 font-medium flex items-center gap-2 text-white shadow-md hover:shadow-lg",3,"bg-red-500","hover:bg-red-400","bg-green-500","hover:bg-green-400","click",4,"ngIf"],[1,"px-4","py-2","rounded-lg","transition-all","duration-200","font-medium","flex","items-center","gap-2","text-white","shadow-md","hover:shadow-lg",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z",4,"ngIf"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"],[1,"flex-1","overflow-y-auto","p-4","space-y-4","area-mensajes"],["class","text-center py-12",4,"ngIf"],["class","flex gap-3 mensaje-entrada",3,"flex-row-reverse","justify-start","justify-end",4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-center","py-12"],[1,"inline-flex","items-center","justify-center","w-16","h-16","bg-blue-100","rounded-full","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-blue-600"],[1,"text-lg","font-semibold","text-gray-800","mb-2"],[1,"text-gray-600","max-w-md","mx-auto"],[1,"flex","gap-3","mensaje-entrada"],[1,"flex","flex-col","items-center","flex-shrink-0"],[1,"relative"],["onerror","this.style.display='none'; this.nextElementSibling.style.display='flex'",1,"w-10","h-10","rounded-full","object-cover","border-2","shadow-sm","avatar","transition-transform",3,"src","alt"],[1,"w-10","h-10","rounded-full","border-2","flex","items-center","justify-center","text-sm","font-bold","text-white","hidden"],["class","mt-1 px-1 py-0.5 bg-blue-600 text-white text-xs rounded-full",4,"ngIf"],[1,"max-w-xs","lg:max-w-md","xl:max-w-lg"],[1,"rounded-2xl","px-4","py-3","shadow-sm","transition-all"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium"],[1,"text-xs","opacity-75"],[1,"message-content"],[1,"text-sm","leading-relaxed","whitespace-pre-wrap"],["class","text-xs mt-2 italic opacity-75 flex items-center gap-1",4,"ngIf"],[1,"mt-1","px-1","py-0.5","bg-blue-600","text-white","text-xs","rounded-full"],[1,"text-xs","mt-2","italic","opacity-75","flex","items-center","gap-1"],[1,"p-4","bg-white","border-t","border-gray-200","shadow-lg"],[1,"flex","items-center","gap-3","mb-3","text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"w-6","h-6","rounded-full","bg-blue-500","flex","items-center","justify-center"],[1,"text-xs","font-bold","text-white"],["class","px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full font-medium",4,"ngIf"],[1,"flex","gap-3","items-end"],[1,"flex-1"],["placeholder","Escribe tu mensaje aqu\xED... (Ctrl + Enter para enviar)","rows","3","maxlength","1000",1,"w-full","p-4","border","border-gray-300","rounded-2xl","resize-none","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:border-transparent","transition-all","pr-16",3,"ngModelChange","keydown.enter","ngModel"],[1,"absolute","bottom-2","right-2","text-xs","text-gray-400"],[1,"text-xs","text-gray-500","mt-2","flex","items-center","gap-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],["class","text-green-600",4,"ngIf"],[1,"bg-blue-600","hover:bg-blue-500","disabled:bg-gray-400","disabled:cursor-not-allowed","text-white","px-6","py-3","rounded-xl","transition-all","duration-200","flex","items-center","gap-2","font-medium","shadow-md","hover:shadow-lg",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 19l9 2-9-18-9 18 9-2zm0 0v-8"],[1,"hidden","sm:inline"],[1,"px-2","py-0.5","bg-blue-100","text-blue-700","text-xs","rounded-full","font-medium"],[1,"text-green-600"],[1,"p-6","bg-gray-50","border-t","border-gray-200","text-center"],[1,"inline-flex","items-center","justify-center","w-12","h-12","bg-red-100","rounded-full","mb-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-red-600"],[1,"text-lg","font-semibold","text-gray-800","mb-1"],[1,"text-gray-600"],[1,"flex-1","flex","items-center","justify-center","bg-gradient-to-br","from-gray-50","to-gray-100"],[1,"text-center","max-w-md","mx-auto","p-8"],[1,"inline-flex","items-center","justify-center","w-20","h-20","bg-blue-100","rounded-full","mb-6"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","text-blue-600"],[1,"text-2xl","font-bold","text-gray-800","mb-3"],[1,"text-gray-600","mb-6"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","text-left"],[1,"font-semibold","text-blue-800","mb-2"],[1,"text-sm","text-blue-700","space-y-1"]],template:function(e,i){e&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div")(5,"h2",5),l(6,"\u{1F4AC} Discusiones"),o(),a(7,"p",6),l(8),o()(),a(9,"div",7)(10,"div",8)(11,"span",9),l(12),o()()()(),g(13,_e,4,0,"button",10),o(),g(14,ye,36,5,"div",11),a(15,"div",12),g(16,we,8,2,"div",13)(17,De,25,26,"div",14),o()(),a(18,"div",15),g(19,Pe,24,16,"div",16)(20,Ve,4,3,"div",17)(21,Re,28,13,"div",18)(22,Ue,8,0,"div",19)(23,He,20,1,"div",20),o()()),e&2&&(s(8),X(" ",i.temasDiscusion.length," tema",i.temasDiscusion.length!==1?"s":""," ",i.hayMensajesNoLeidos()?"\u2022 "+i.totalMensajesNoLeidos()+" nuevos":""," "),s(4),v(i.obtenerIniciales((i.usuarioActual==null?null:i.usuarioActual.nombre)||"U")),s(),d("ngIf",i.isAdmin),s(),d("ngIf",i.mostrarFormularioTema&&i.isAdmin),s(2),d("ngIf",i.temasDiscusion.length===0),s(),d("ngForOf",i.temasDiscusion)("ngForTrackBy",i.trackByTema),s(2),d("ngIf",i.temaSeleccionado),s(),d("ngIf",i.temaSeleccionado),s(),d("ngIf",i.temaSeleccionado&&i.temaSeleccionado.estado==="activo"),s(),d("ngIf",i.temaSeleccionado&&i.temaSeleccionado.estado==="cerrado"),s(),d("ngIf",!i.temaSeleccionado))},dependencies:[Z,J,ee,ce,de,ue,ne,le,ae,oe,me,pe,se,re,te],styles:['.transition-all[_ngcontent-%COMP%]{transition:all .3s ease}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.hover\\:bg-gray-50[_ngcontent-%COMP%]:hover{background-color:#f9fafb;transition:background-color .2s ease}.hover\\:bg-blue-400[_ngcontent-%COMP%]:hover{background-color:#60a5fa;transition:background-color .2s ease}.hover\\:bg-blue-500[_ngcontent-%COMP%]:hover{background-color:#3b82f6;transition:background-color .2s ease}.hover\\:bg-green-400[_ngcontent-%COMP%]:hover{background-color:#4ade80;transition:background-color .2s ease}.hover\\:bg-green-500[_ngcontent-%COMP%]:hover{background-color:#22c55e;transition:background-color .2s ease}.hover\\:bg-red-400[_ngcontent-%COMP%]:hover{background-color:#f87171;transition:background-color .2s ease}.hover\\:bg-gray-400[_ngcontent-%COMP%]:hover{background-color:#9ca3af;transition:background-color .2s ease}.mensaje-entrada[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideInFromBottom .3s ease-out}@keyframes _ngcontent-%COMP%_slideInFromBottom{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.estado-activo[_ngcontent-%COMP%]{position:relative}.estado-activo[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:-8px;transform:translateY(-50%);width:4px;height:20px;background-color:#22c55e;border-radius:2px}.estado-cerrado[_ngcontent-%COMP%]{opacity:.7}.estado-cerrado[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:-8px;transform:translateY(-50%);width:4px;height:20px;background-color:#ef4444;border-radius:2px}.contador-no-leidos[_ngcontent-%COMP%]{min-width:20px;height:20px;border-radius:10px;background-color:#ef4444;color:#fff;font-size:12px;font-weight:600;display:flex;align-items:center;justify-content:center;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.formulario-nuevo-tema[_ngcontent-%COMP%]{background:linear-gradient(135deg,#eff6ff,#dbeafe);border-left:4px solid #3b82f6}.area-mensajes[_ngcontent-%COMP%]{background-image:radial-gradient(circle at 1px 1px,rgba(0,0,0,.02) 1px,transparent 0);background-size:20px 20px}.burbuja-admin[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#1d4ed8);box-shadow:0 4px 12px #3b82f64d}.burbuja-usuario[_ngcontent-%COMP%]{background:#fff;border:1px solid #e5e7eb;box-shadow:0 2px 8px #0000001a}.avatar[_ngcontent-%COMP%]{transition:transform .2s ease}.avatar[_ngcontent-%COMP%]:hover{transform:scale(1.1)}@media (max-width: 768px){.w-1\\/3[_ngcontent-%COMP%]{width:100%;position:absolute;z-index:10;height:50vh}.flex-1[_ngcontent-%COMP%]{padding-top:50vh}}.indicador-escribiendo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;padding:8px 16px;background-color:#f3f4f6;border-radius:16px;margin:8px 0}.indicador-escribiendo[_ngcontent-%COMP%]   .punto[_ngcontent-%COMP%]{width:6px;height:6px;background-color:#6b7280;border-radius:50%;animation:_ngcontent-%COMP%_escribiendo 1.4s infinite}.indicador-escribiendo[_ngcontent-%COMP%]   .punto[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.indicador-escribiendo[_ngcontent-%COMP%]   .punto[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_escribiendo{0%,60%,to{transform:translateY(0)}30%{transform:translateY(-10px)}}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.btn-gradient[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#1d4ed8);transition:all .3s ease}.btn-gradient[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#1d4ed8,#1e40af);transform:translateY(-1px);box-shadow:0 8px 25px #3b82f666}.input-focus[_ngcontent-%COMP%]:focus{outline:none;ring:2px;ring-color:#3b82f6;border-color:transparent;box-shadow:0 0 0 3px #3b82f61a}.tag-terapia[_ngcontent-%COMP%]{background:linear-gradient(135deg,#dcfce7,#bbf7d0);color:#166534}.tag-rutina[_ngcontent-%COMP%]{background:linear-gradient(135deg,#fae8ff,#f3e8ff);color:#7c2d12}']})};var Ge=[{path:"",component:O}],N=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=P({type:r});static \u0275inj=k({imports:[V.forChild(Ge),V]})};var he=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=P({type:r});static \u0275inj=k({imports:[ie,N]})};export{he as ChatDiscussionModule};
