<div class="relative inline-block" [ngClass]="sizeClasses">
  <!-- Avatar Image -->
  <div 
    class="rounded-full overflow-hidden bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold shadow-lg"
    [ngClass]="sizeClasses"
  >
    <img 
      *ngIf="user?.avatar_url; else initialsTemplate"
      [src]="avatarUrl" 
      [alt]="user?.full_name || 'Avatar'"
      class="w-full h-full object-cover"
      (error)="$any($event.target).style.display='none'"
    />
    
    <ng-template #initialsTemplate>
      <span [ngClass]="{
        'text-xs': size === 'sm',
        'text-sm': size === 'md', 
        'text-base': size === 'lg',
        'text-xl': size === 'xl'
      }">
        {{ initials }}
      </span>
    </ng-template>
  </div>

  <!-- Edit Button (solo si es editable) -->
  <button 
    *ngIf="editable && !isUploading"
    (click)="fileInput.click()"
    class="absolute bottom-0 right-0 bg-blue-500 hover:bg-blue-600 text-white rounded-full p-1 shadow-lg transition-all duration-200 transform hover:scale-110"
    [ngClass]="{
      'w-6 h-6': size === 'sm' || size === 'md',
      'w-8 h-8': size === 'lg' || size === 'xl'
    }"
    title="Cambiar foto"
  >
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-full h-full">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
  </button>

  <!-- Loading Spinner -->
  <div 
    *ngIf="isUploading"
    class="absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center"
  >
    <div class="animate-spin rounded-full border-2 border-white border-t-transparent"
         [ngClass]="{
           'h-4 w-4': size === 'sm',
           'h-6 w-6': size === 'md',
           'h-8 w-8': size === 'lg',
           'h-12 w-12': size === 'xl'
         }">
    </div>
  </div>

  <!-- Hidden File Input -->
  <input 
    #fileInput
    type="file" 
    accept="image/*" 
    (change)="onFileSelected($event)"
    class="hidden"
  />
</div>